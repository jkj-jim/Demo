<!DOCTYPE html>
<!--五子棋3月25版本，攻防兼具，可以跳步，内测版-->
<html>
	<head>
		<meta charset="UTF-8">
		<title>五子棋demo</title>
		<style type="text/css">
			html,body{
				font-size: 20px;
				margin: 0;
				padding: 0;
			}
			.title {
				/*font-family: Tahoma,Helvetica,Arial,'宋体',sans-serif;*/
				font-family:Helvetica, 'Hiragino Sans GB', 'Microsoft Yahei', '微软雅黑', Arial, sans-serif;
				/*font-family:"Arial","Microsoft YaHei","黑体","宋体",sans-serif;*/
				font-size: 1.3rem;
				height: 1rem;
				width: 30rem;
				margin: 5px 1rem 0px;
				text-align: center;
			}
			.chessboard{
				float: left;
				margin: 1rem;
				width: 30rem;
				height: 30rem;
				background:url(img/chessboard.png) no-repeat ;
				box-shadow: 2px 2px 8px #888;
			}
			.chessboard div{
				width:40px;
				width: 2rem;
				height: 40px;
				height: 2rem;
				margin: 0;
				padding: 0;
				float: left;
				cursor: pointer;
			}
			.chessboard-left-top:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:0px 0px ;	
			}
			.chessboard-top:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-40px 0px ;	
			}
			.chessboard-right-top:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-80px 0px ;	
			}
			.chessboard-left:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:0px -40px ;	
			}
			.chessboard-middle:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-40px -40px ;	
			}
			.chessboard-right:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-80px -40px ;	
			}
			.chessboard-left-bottom:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:0px -80px ;	
			}
			.chessboard-bottom:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-40px -80px ;	
			}
			.chessboard-right-bottom:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-80px -80px ;	
			}
			.right{
				float: left;
				margin: 1rem;
			}
			.option{
				margin-bottom: 1rem;
			}
			.option button{
				width: 6rem;
				height: 2rem;
				font-size: 1rem;
				border: 1px solid black;
				margin-right: 1rem;
				border-radius: 0.2rem;
				background-image: -webkit-linear-gradient(top,#F3F3F3 0,#FEFEFE 52px);
			}
			.chess-data {
				
				/*overflow: hidden;*/
			}
			
			.chess-data div{
				margin: 0.5rem 0rem;
			}
			
			.qq{
				/*clear: both;*/
				margin-top: 0.5rem;
			}
			.version p{
				margin: 0;
				padding: 0;
				font-size: 0.7rem;
			}
		</style>
	</head>
	<body>
		<div class="title">
			<span>五子棋</span>
		</div>
		<div class="chessboard" id="chess_board">
			<!--第一行-->
			<div class="chessboard-left-top " ></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-right-top"></div>
			<!--第二行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第3行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第4行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第5行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第6行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第7行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第8行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第9行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第10行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第11行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第12行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第13行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第14行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第15行-->
			<div class="chessboard-left-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-right-bottom"></div>
			
		</div>
		<div class="right">
			<div class="option">
				<button id="black">玩家执黑</button>
				<button id="white">玩家执白</button>
			</div>
			<div class="chess-data">
				<div class="score">
					胜/负：<span id="score_human">0</span>/<span id="score_ai">0</span>
				</div>
				<div class="step">
					步数：<span id="step_num"></span>	
				</div>
				<div class="time">
					用时：<span id="time_num"></span>	
				</div>
			</div>
			<div class="qq">
				<a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=616692289&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:616692289:53" alt="点击这里给我发消息" title="点击这里给我发消息"/></a>
			</div>
			<div class="version">
				<p>v1.0完成棋盘div布局</p>
				<p>v1.1完成规则系统</p>
				<p>v2.1完成棋盘、棋子UI设计并嵌入网页，完成简单悬停交互设计</p>
				<p>v2.2完成落子动作与落子效果</p>
				<p>v2.3优化规则系统，实现PvP正常对战</p>
				<p>v3.0优化代码，提供更为方便的函数接口</p>
				<p>v4.0完成基础AI(选点，权重计算，权重比较，自动落子)，精简了一些代码</p>
				<p>v5.0优化基础AI与规则系统，完成AI的防守动作</p>
				<p>v6.0优化了防守策略，优化了一些bug</p>
				<p>v6.1增加简单交互和数据展示与监控</p>
				<p>v7.0加强AI防守算法，完成AI基础进攻动作</p>
				<p>v8.0加强AI权重设定，优化落子</p>
				<p>v9.0加强AI攻防，测试阶段</p>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		init();//初始化，复位
//		function Player (name) {
//			this.name=name;
//			this.color;
//			this.chessnum=0;
//		}
//		function AiPlayer(color){
//			this.dochess=dochess;
//			function dochess (target) {
//			}
//		}
		
		function init () {
			var chessboard=document.getElementById("chess_board");
			var chesscell=chessboard.getElementsByTagName("div");
			var stepnum=document.getElementById("step_num");
			var timenum=document.getElementById("time_num");
			var scorehuman=document.getElementById("score_human");
			var scoreai=document.getElementById("score_ai");
			var playerblack=document.getElementById("black");
			var playerwhite=document.getElementById("white");
			var scorehumannum=0;
			var scoreainum=0;
			var nowChess;
			var time=0;
			var settime;
			var step=0;
			var playercolor="black";
			var aicolor="white";
			var playerstatus="black";
			var player="human";
			var xianshou="human";
			var matrix=[];//棋盘矩阵
			clear();
			toMatrix();
			settime=setInterval(function () {//计时器函数
				time++;
				if (time<10) {
					timenum.innerHTML="00:0"+time;
				}else if(time<60){
					timenum.innerHTML="00:"+time;
				}else if((time/60)<10){
					if ((time%60)<10) {
						timenum.innerHTML="0"+parseInt(time/60)+":0"+time%60;
					} else{
						timenum.innerHTML="0"+parseInt(time/60)+":"+time%60;
					}
				}else if((time/60)<60){
					if ((time%60)<10) {
						timenum.innerHTML=parseInt(time/60)+":0"+time%60;
					} else{
						timenum.innerHTML=parseInt(time/60)+":"+time%60;
					}
				}
			},1000);
			playerblack.onclick=function () {
				playercolor="black";
				aicolor="white";
				playerblack.style.border="3px solid green";
				playerwhite.style.border="1px solid black";
				clear();
			}
			playerwhite.onclick=function () {
				playercolor="white";
				aicolor="black";
				playerwhite.style.border="3px solid green";
				playerblack.style.border="1px solid black";
				clear();
				var x,y;
				x=5+Math.floor(5*Math.random());
				y=5+Math.floor(5*Math.random());
				downChess(matrix[x][y],aicolor);
				
			}
			chessboard.addEventListener("click",function (e) {
					step++;
					stepnum.innerHTML=step;
					e.target=e.target||e.srcElement;
					nowChess=e.target;
					if (nowChess.nodeName!="DIV"||nowChess.dataset.color!="") {
						alert("请选择有效位置");
						return;	
					}
						downChess(nowChess,playercolor);
						if(rule(nowChess,playercolor))return;
//						if(downChess(nowChess,playercolor))return;
//						blackMan.chessnum++;
							nowChess=aiDochess(nowChess,aicolor);
							downChess(nowChess,aicolor);
							if(rule(nowChess,aicolor))return;
//							if(downChess(nowChess,aicolor))return;
					console.log("这是间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔");
			});
			//下面是内部函数
			//清屏函数,改变一些状态参数
			function clear() {
//				clearInterval(settime);
				time=0;
				timenum.innerHTML="00:00";
				stepnum.innerHTML=0;
				step=0;
//				playerstatus="black";
				for (var i=0;i<chesscell.length;i++) {
					chesscell[i].dataset.color="";
					chesscell[i].style.background="";
				}
			}
			//将棋盘中每一个受体div存入矩阵当中
			function toMatrix() {
				var count=0;
				for (var i=0;i<15;i++) {
					matrix[i]=[]	;
					for (var j=0;j<15;j++) {
						matrix[i][j]=chesscell[count];
						count=count+1;
					}
				}
			}
			//获得当前div坐标，并return
			function getCoordinate(target){
				var mindex=[];
				for (var i=0;i<matrix.length;i++) {
					for (var j=0;j<matrix[i].length;j++) {
						if (matrix[i][j]==target) {
							mindex=[i,j];
							return mindex;
						} 
					}
				}
			}
			//判断一个div颜色
			function checkColor (target,color) {
				if(target.dataset.color==color){
						return true;
					}
				else{
					return false;
				}
			}
			//改进的查找所有方向相同颜色连续div数目，返回一个装有所有方向有效连续div数目的矩阵
			function dirsDivnums (target,color) {
				var dirnum=[];
				for (var i=0;i<4;i++) {
					dirnum[i]=checkDir(target,i,color)+checkDir(target,7-i,color);
				}	
//				console.log(dirnum,target);
				return dirnum;
			}
			//查找制定方向、颜色的连续div数目
			function checkDir (target,dir,color) {
				var div=dirTarget(target,dir);
				var num=0;
					if (div!=undefined&&checkColor(div,color)) {
						num++;
						num+=checkDir(div,dir,color);	
					}
				return num;
			}
			//查找指定方向距离为1的div，返回此div，不判断是否为有色的div
			function dirTarget(target,dir){
				var nxny=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];//不同方向的相对坐标,0-7的八个方向
				var mindex=getCoordinate(target);
//				console.log(mindex);
				var x=mindex[0]+nxny[dir][0];
				var y=mindex[1]+nxny[dir][1];
				var div;
				if (x<0||x>14||y<0||y>14) {//边界条件
						div=undefined;
					}else{
					div=matrix[x][y];//获得指定方向对象	
					}
				return div;
			}
			//落子状态改变
			function downChess (target,color) {
				if(color=="black"){
					target.style.background="url(img/fivechess.png) no-repeat ";
					target.style.backgroundPosition="-120px 0px ";
					target.dataset.color="black";
//					if(rule(target,color)) return true;
					playerstatus="white";
				}else{
					target.style.background="url(img/fivechess.png) no-repeat ";
					target.style.backgroundPosition="-160px 0px ";
					target.dataset.color="white";
//					if(rule(target,color)) return true;
					playerstatus="black";
				}
			}
			//判断是否获胜
			function rule (target,color) {
				var chessDirNum=[];
				chessDirNum=dirsDivnums(target,color);
//				console.log(chessDirNum,color);
				for (var i=0;i<4;i++) {
					if(chessDirNum[i]>3){
						setTimeout(function () {
							if (color==playercolor) {
								alert("天了噜，你用了"+step+"步才赢了我");
							}else if (color==aicolor) {
								alert("我赢了，仅用了"+step+"步。");
							}
							clear();
							if (aicolor=="black") {
								var x,y;
								x=5+Math.floor(5*Math.random());
								y=5+Math.floor(5*Math.random());
								downChess(matrix[x][y],aicolor);
							}
						},100);
					if (player=="human") {
						scorehumannum++;
						scorehuman.innerHTML=scorehumannum;
						player=xianshou;
					}else{
						scoreainum++;
						scoreai.innerHTML=scoreainum;
						player=xianshou;
					}
						return true;
					}
				}
				player=(player=="human")?"ai":"human";
			}
			//4个方向为基准返回权重，第一个为单列权重最大值，第二个为所有方向权重总和
			function levelson(target,color){
				var uncolor=(color=="white")?"black":"white";
				var chessDirNum=[];
				var unchessDirNum=[];
				var divdata=[undefined,0,0,0,0];//对象，同色单列最大权重，同色总权重，反色单列最大权重，反色总权重
				chessDirNum=dirsDivnumson(target,color);//同色的各方向权重数据
				unchessDirNum=dirsDivnumson(target,uncolor);//反色的各方向权重数据
//				console.log(chessDirNum);
				for (var i=0;i<4;i++) {
					if (divdata[1]<chessDirNum[i]) {
						divdata[1]=chessDirNum[i];
					}
					divdata[2]+=chessDirNum[i];
				}
				for (var i=0;i<4;i++) {
					if (divdata[3]<unchessDirNum[i]) {
						divdata[3]=unchessDirNum[i];
					}
					divdata[4]+=unchessDirNum[i];
				}
				divdata[0]=target;
				return divdata;
				//下面为内部函数
				
				//改进的查找所有方向相同颜色连续div数目，返回一个装有所有方向有效连续div数目的矩阵
					function dirsDivnumson (target,color) {
						var dirnum=[];
						var numx=0;
						var numy=0;
						var huosan=0;
						var miansi=0;
						var tiaoer=0;
						var tiaosan=0;
						for (var i=0;i<4;i++) {
							numx=checkDirson(target,i,color,1);
							numy=checkDirson(target,7-i,color,1);
							if (numx<0) {
								numx=1;
							}else if(numy<0){
								numy=1;
							}
							if (numx>9990||numy>9990) {//跳1，跳2，跳3，有一边或者两边都为跳
								if (numx>39990||numy>39990) {
									dirnum[i]=0;
									continue;
								}else if (numy>29990||numx>29990) {//跳2，跳3
									tiaosan++;
									tiaoer++;
									if (tiaosan>1||tiaoer>1||tiaoer+miansi>1) {
										dirnum[i]=3100;//双跳三
										tiaosan=0;
										tiaoer=0;
										continue;
									}
									if (huosan+tiaoer>1) {
										dirnum[i]=3100;//双活二活活二加眠三，大于活二小于活三
										huosan=0;
										continue;
									}
									if (numy>9990&&numx>9990) {//两边跳
										dirnum[i]=3002;
										continue;
									}else if(numy<9990||numx<9990){//一边为跳的情况
										if (numy>9990) {//y边跳,权重为2另外一边正常
											numy=2;
										}else if(numx>9990){//x边跳,权重为2另外一边正常
										numx=2;	
										}
									}
								}else if (numy>20000||numx>20000) {
									tiaoer++;
									if (tiaoer>1||tiaoer+miansi>1) {
										dirnum[i]=3100;//双眠三
										tiaoer=0;
										continue;
									}
									if (huosan+tiaoer>1) {
										dirnum[i]=3100;//双活二活活二加眠三，大于活二小于活三
										huosan=0;
										continue;
									}
									if (numy>9990&&numx>9990) {//两边跳
										dirnum[i]=2002;
										continue;
									}else if(numy<9990||numx<9990){//一边为跳的情况
										if (numy>9990) {//y边跳,权重为2另外一边正常
											numy=2;
										}else if(numx>9990){//x边跳,权重为2另外一边正常
										numx=2;	
										}
									}
								}else if (numy>19990||numx>19990){
									if (numy>9990&&numx>9990) {//两边跳
										dirnum[i]=2002;
										continue;
									}else if(numy<9990||numx<9990){//一边为跳的情况
										if (numy>9990) {//y边跳,权重为2另外一边正常
											numy=2;
										}else if(numx>9990){//x边跳,权重为2另外一边正常
										numx=2;	
										}
									}
								}else if (numy>9990&&numx>9990){//两边跳
									dirnum[i]=1002;
										continue;
								}else if (numy<9990||numx<9990){//一边为跳的情况
									if (numy>9990) {//y边跳,权重为2另外一边正常
										numy=2;
									}else if(numx>9990){//x边跳,权重为2另外一边正常
									numx=2;	
									}
								}
							}
							if((numx%1000===0)&&(numy%1000===0)) {//两头堵，死
								if (numx+numy>3900) {//死四(4000)才堵
								dirnum[i]=numx+numy;
								}else{
								dirnum[i]=0;	
								}
							}else if((numx%1000!==0)&&(numy%1000!==0)){//两头活，双三，活二
								 if(numx+numy<1000) {
									dirnum[i]=numx+numy;
								}else{
									dirnum[i]=numx+numy+500;//活1(15004-)，2(25004-)，3(35004-)，4(已经输了45004-)	
								}
								if (numx+numy>2000&&numx+numy<3000) {
									huosan++;//活三数目
									if (huosan+miansi>1||huosan+tiaoer>1) {
										dirnum[i]=3100;//双活二活活二加眠三，大于活二小于活三
										huosan=0;
									}
								}
							}else{//一头堵，眠
								if (numx+numy>3000) {
									miansi++;//眠三数目
									if (miansi>1||tiaoer+miansi>1) {
										dirnum[i]=4000;//双眠三
										miansi=0;
										continue;
									}
									if (huosan+miansi>1) {
										dirnum[i]=3100;//双活二活活二加眠三，大于活二小于活三
										huosan=0;
										continue;
									}
								}
								//眠0(1|2)，1(400)，2(1400)，3(2400)，4(4000)
								if (numx+numy<1000) {
									dirnum[i]=numx+numy;
								}else if(numx+numy<3500) {
									dirnum[i]=numx-numx%1000+numy-numy%1000-600;
								}else{
									dirnum[i]=numx-numx%1000+numy-numy%1000;
								}
							}
						}	
//						console.log(dirnum,target);
						return dirnum;
					}
					//查找制定方向、颜色的连续div数目，根据数目返回权重
					function checkDirson (target,dir,color,status) {
						var div=dirTarget(target,dir);
						var num=0;
						////////////////////////////////////分界线
						if (status==1) {
							if (div!=undefined&&checkColor(div,color)) {
								num=num+1000;//一个方向有一个相同子权重+100，继续检查这个方向上的下一个
								num+=checkDirson(div,dir,color,2);	
							}else if(div!=undefined&&div.dataset.color==""){
								num=1;
								num+=checkDirson(div,dir,color,3);
							}	
						}else if(status==2){
							if (div!=undefined&&checkColor(div,color)) {
								num=num+1000;//一个方向有一个相同子权重+100，继续检查这个方向上的下一个
								num+=checkDirson(div,dir,color,2);	
							}else if(div!=undefined&&div.dataset.color==""){
								num=1;
								div=dirTarget(div,dir);
								if (div!=undefined&&checkColor(div,color)) {
									num=2;
								}
							}
						}else if(status==3){
							if (div!=undefined&&checkColor(div,color)) {
								num=num+10000;
								num+=checkDirson(div,dir,color,3);
							}else if(div!=undefined&&div.dataset.color==""){
								num=0;
							}else{
								num=-2;
							}	
						}
						return num;
					}	
			}	
				function comparel (arrA,arrB) {//对权重按先后优先级进行比较，返回权重大的
					var arrC=[];
					for (var i=1;i<arrA.length;i++) {//从第二位开始，避开第一位的对象
						arrC[i]=arrA[i]-arrB[i];
					}
					for (var i=1;i<arrC.length;i++) {
						if (arrC[i]>0) {
							return arrA;
						}else if (arrC[i]<0) {
							return arrB;
						}	
					}
					return arrA;
				}
			
			//AI防守，列举可下点->计算每点权重->得出选择点
			function choosePF (targets,color) {
				var	mdivdata=[undefined,0,0];//存放最大权重对象数据
				var divdata=[undefined,0,0];//存放当前对象的权重
					for(var i=0;i<15;i++){
						for (var j=0;j<15;j++) {
							if (targets[i][j].dataset.color=="") {
							divdata=levelson(targets[i][j],color);//周围空位点对应的权重
//							console.log(divdata);
							if (divdata[1]>3800) {
								return divdata;
							}
							mdivdata=comparel(divdata,mdivdata);//好的放在最后
							}
						}
					}
				return mdivdata;
			}
			//AI进行落子步骤
			function aiDochess(ptarget,color){
				var p_data;
				var a_data;
				var div;
				var uncolor=(color=="white")?"black":"white";
				p_data=choosePF(matrix,uncolor);
				a_data=choosePF(matrix,color);
				console.log("这是防守点");
				console.log(p_data);
				console.log("这是进攻点");
				console.log(a_data);
				if (p_data[1]>3999) {
					div=p_data[0];
				}else if(p_data[1]<=a_data[1]||a_data[1]>3400){
					//当进攻防守权重相同，或者进攻为活三则进攻
					div=a_data[0];
				}else{div=p_data[0];}
				return div;
			}
		}
	</script>
</html>
