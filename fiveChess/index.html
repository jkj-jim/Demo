<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			html,body{
				font-size: 20px;
				margin: 0;
				padding: 0;
			}
			.title {
				/*font-family: Tahoma,Helvetica,Arial,'宋体',sans-serif;*/
				font-family:Helvetica, 'Hiragino Sans GB', 'Microsoft Yahei', '微软雅黑', Arial, sans-serif;
				/*font-family:"Arial","Microsoft YaHei","黑体","宋体",sans-serif;*/
				font-size: 1.3rem;
				height: 1rem;
				width: 30rem;
				margin: 5px 1rem 0px;
				text-align: center;
			}
			.chessboard{
				float: left;
				margin: 1rem;
				width: 30rem;
				height: 30rem;
				background:url(img/chessboard.png) no-repeat ;
				box-shadow: 2px 2px 8px #888;
			}
			.chessboard div{
				width:40px;
				width: 2rem;
				height: 40px;
				height: 2rem;
				margin: 0;
				padding: 0;
				float: left;
				cursor: pointer;
			}
			.chessboard-left-top:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:0px 0px ;	
			}
			.chessboard-top:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-40px 0px ;	
			}
			.chessboard-right-top:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-80px 0px ;	
			}
			.chessboard-left:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:0px -40px ;	
			}
			.chessboard-middle:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-40px -40px ;	
			}
			.chessboard-right:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-80px -40px ;	
			}
			.chessboard-left-bottom:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:0px -80px ;	
			}
			.chessboard-bottom:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-40px -80px ;	
			}
			.chessboard-right-bottom:hover{
				background: url(img/fivechess.png) no-repeat;
				background-position:-80px -80px ;	
			}
			.right{
				float: left;
				margin: 1rem;
			}
			.option button{
				width: 6rem;
				height: 2rem;
				font-size: 1rem;
				border: 1px solid black;
				margin-right: 1rem;
				border-radius: 0.2rem;
				background-image: -webkit-linear-gradient(top,#F3F3F3 0,#FEFEFE 52px);
			}
			.chess-data div{
				margin: 0.5rem 0px;
				/*float: left;*/
				/*margin: 1rem;*/
			}
			.qq{
				/*float: left;*/
				margin-top: 1rem;
			}
			.version p{
				margin: 0;
				padding: 0;
				font-size: 0.7rem;
			}
		</style>
	</head>
	<body>
		<div class="title">
			<span>五子棋</span>
		</div>
		<div class="chessboard" id="chess_board">
			<!--第一行-->
			<div class="chessboard-left-top " ></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-top"></div>
			<div class="chessboard-right-top"></div>
			<!--第二行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第3行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第4行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第5行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第6行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第7行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第8行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第9行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第10行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第11行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第12行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第13行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第14行-->
			<div class="chessboard-left"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-middle"></div>
			<div class="chessboard-right"></div>
			<!--第15行-->
			<div class="chessboard-left-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-bottom"></div>
			<div class="chessboard-right-bottom"></div>
			
		</div>
		<div class="right">
			<div class="option">
				<button id="black">玩家执黑</button>
				<button id="white">玩家执白</button>
			</div>
			<div class="chess-data">
				<div class="score">
					<p>胜/负：<span id="score_human">0</span>/<span id="score_ai">0</span></p>
				</div>
				<div class="step">
					步数：<span id="step_num"></span>	
				</div>
				<div class="time">
					用时：<span id="time_num"></span>	
				</div>
			</div>
			<div class="qq">
				<a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=616692289&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:616692289:53" alt="点击这里给我发消息" title="点击这里给我发消息"/></a>
			</div>
			<div class="version">
				<p>v1.0完成棋盘div布局</p>
				<p>v1.1完成规则系统</p>
				<p>v2.1完成棋盘、棋子UI设计并嵌入网页，完成简单悬停交互设计</p>
				<p>v2.2完成落子动作与落子效果</p>
				<p>v2.3优化规则系统，实现PvP正常对战</p>
				<p>v3.0优化代码，提供更为方便的函数接口</p>
				<p>v4.0完成基础AI(选点，权重计算，权重比较，自动落子)，精简了一些代码</p>
				<p>v5.0优化基础AI与规则系统，完成AI的防守动作</p>
				<p>v6.0优化了防守策略，优化了一些bug</p>
				<p>v6.1增加简单交互和数据展示与监控</p>
				<p>v7.0加强AI防守算法，完成AI基础进攻动作</p>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		
		init();//初始化，复位
		function Player (name) {
			this.name=name;
			this.color;
			this.chessnum=0;
		}
//		function AiPlayer(color){
//			this.dochess=dochess;
//			function dochess (target) {
//			}
//		}
		
		function init () {
			var chessboard=document.getElementById("chess_board");
			var chesscell=chessboard.getElementsByTagName("div");
			var stepnum=document.getElementById("step_num");
			var timenum=document.getElementById("time_num");
			var scorehuman=document.getElementById("score_human");
			var scoreai=document.getElementById("score_ai");
			var playerblack=document.getElementById("black");
			var playerwhite=document.getElementById("white");
			var playercolor="black";
			var scorehumannum=0;
			var scoreainum=0;
			var nowChess;
			var time=0;
			var settime;
			var step=0;
//			var blackMan=new Player("black");
//			var whiteMan=new Player("white");
			var playerstatus="black";
			var player="human";
			var matrix=[];//棋盘矩阵
			var AImatix=[];//ai的已落点
			clear();
			toMatrix();
			settime=setInterval(function () {
				time++;
				if (time<10) {
					timenum.innerHTML="00:0"+time;
				}else if(time<60){
					timenum.innerHTML="00:"+time;
				}else if((time/60)<10){
					if ((time%60)<10) {
						timenum.innerHTML="0"+parseInt(time/60)+":0"+time%60;
					} else{
						timenum.innerHTML="0"+parseInt(time/60)+":"+time%60;
					}
				}else if((time/60)<60){
					if ((time%60)<10) {
						timenum.innerHTML=parseInt(time/60)+":0"+time%60;
					} else{
						timenum.innerHTML=parseInt(time/60)+":"+time%60;
					}
				}
			},1000);
			playerblack.onclick=function () {
				playercolor="black";
				clear();
			}
			playerwhite.onclick=function () {
				playercolor="white";
				clear();
			}
			chessboard.addEventListener("click",function (e) {
					step++;
					stepnum.innerHTML=step;
					e.target=e.target||e.srcElement;
					nowChess=e.target;
					if (nowChess.nodeName!="DIV"||nowChess.dataset.color!="") {
						alert("请选择有效位置");
						return;	
					}
					
						if(downChess(nowChess,playerstatus))return;
//						blackMan.chessnum++;
						nowChess=aiDochess(nowChess,playerstatus);
						if(downChess(nowChess,playerstatus))return;
					
					console.log("这是间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔间隔");
			});
			//下面是内部函数
			//清屏函数,改变一些状态参数
			function clear() {
//				clearInterval(settime);
				time=0;
				timenum.innerHTML="00:00";
				stepnum.innerHTML=0;
				step=0;
				AImatix=[];
				playerstatus=playercolor;
				for (var i=0;i<chesscell.length;i++) {
					chesscell[i].dataset.color="";
					chesscell[i].style.background="";
				}
			}
			//将棋盘中每一个受体div存入矩阵当中
			function toMatrix() {
				var count=0;
				for (var i=0;i<15;i++) {
					matrix[i]=[]	;
					for (var j=0;j<15;j++) {
						matrix[i][j]=chesscell[count];
						count=count+1;
					}
				}
			}
			//获得当前div坐标，并return
			function getCoordinate(target){
				var mindex=[];
				for (var i=0;i<matrix.length;i++) {
					for (var j=0;j<matrix[i].length;j++) {
						if (matrix[i][j]==target) {
							mindex=[i,j];
							return mindex;
						} 
					}
				}
			}
			//判断一个div颜色
			function checkColor (target,color) {
				if(target.dataset.color==color){
						return true;
					}
				else{
					return false;
				}
			}
			//改进的查找所有方向相同颜色连续div数目，返回一个装有所有方向有效连续div数目的矩阵
			function dirsDivnums (target,color) {
				var dirnum=[];
				for (var i=0;i<4;i++) {
					dirnum[i]=checkDir(target,i,color)+checkDir(target,7-i,color);
				}	
//				console.log(dirnum,target);
				return dirnum;
			}
			//查找制定方向、颜色的连续div数目
			function checkDir (target,dir,color) {
				var div=dirTarget(target,dir);
				var num=0;
					if (div!=undefined&&checkColor(div,color)) {
						num++;
						num+=checkDir(div,dir,color);	
					}
				return num;
			}
			//查找指定方向距离为1的div，返回此div，不判断是否为有色的div
			function dirTarget(target,dir){
				var nxny=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];//不同方向的相对坐标,0-7的八个方向
				var mindex=getCoordinate(target);
//				console.log(mindex);
				var x=mindex[0]+nxny[dir][0];
				var y=mindex[1]+nxny[dir][1];
				var div;
				if (x<0||x>14||y<0||y>14) {//边界条件
						div=undefined;
					}else{
					div=matrix[x][y];//获得指定方向对象	
					}
				return div;
			}
			//落子状态改变
			function downChess (target,color) {
				
				if(color=="black"){
					target.style.background="url(img/fivechess.png) no-repeat ";
					target.style.backgroundPosition="-120px 0px ";
					target.dataset.color="black";
					if(rule(target,color)) return true;
					playerstatus="white";
				}else{
					target.style.background="url(img/fivechess.png) no-repeat ";
					target.style.backgroundPosition="-160px 0px ";
					target.dataset.color="white";
					if(rule(target,color)) return true;
					playerstatus="black";
				}
				
			}
			//判断是否获胜
			function rule (target,color) {
				var chessDirNum=[];
				chessDirNum=dirsDivnums(target,color);
//				console.log(chessDirNum,color);
				for (var i=0;i<4;i++) {
					if(chessDirNum[i]>3){
						setTimeout(function () {
							alert(color+" win!");
							clear();
						},10);
					if (player=="human") {
						scorehumannum++;
						scorehuman.innerHTML=scorehumannum;
					}else{
						scoreainum++;
						scoreai.innerHTML=scoreainum;
					}
						return true;
					}
				}
				if (player=="human") {
					player="ai";
				}else{
					player="human";
				}
			}
			
			
			//下面为AI函数
			//返回所有方向上终端不为指定颜色的点位，返回的为可以落子的点
			function linesDirTarget(target,color){
				var nxny=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];//不同方向的相对坐标,0-7的八个方向
				var mindex=getCoordinate(target);
				var x;
				var y;
				var divs=[];
				var div;
				var count=0;
				var ardivs=canAroundChess(target,color);//获取原始点位周围有连接的点位，其在数组中的位置为其相对于原始点位的位置
				for (var i=0;i<ardivs.length;i++) {
					if(ardivs[i]!=undefined){
					x=mindex[0]+nxny[i][0]+nxny[i][0];
					y=mindex[1]+nxny[i][1]+nxny[i][1];	
						do{
							if (x<0||x>14||y<0||y>14) {//边界条件
							div=undefined;
							}else{
							div=matrix[x][y];//获得指定方向对象	
							}
							if (div!=undefined&&div.dataset.color=="") {
								divs[count]=div;
								count++;
							}
							x=x+nxny[i][0];
							y=y+nxny[i][1];
						}while(div!=undefined&&div.dataset.color==color)		
					}
				}
				return divs;//返回最多8个对象
			}
		
			//返回目标周围1圈的所有点位（div对象），符合要求的为对象，不符合要求的为undefined，若color=""则返回周围可以落子的地方
			function canAroundChess (target,color) {
				var divs=[];
				var div;
				var nxny=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];//不同方向的相对坐标,0-7的八个方向
				var mindex=getCoordinate(target);
				var x=mindex[0];
				var y=mindex[1];
				for (var i=0;i<8;i++) {
					x+=nxny[i][0];
					y+=nxny[i][1];
//					console.log(x,y);	
					if (x<0||x>14||y<0||y>14) {//边界条件
						div=undefined;
					}else{
						div=matrix[x][y];//获得指定方向对象
						if (div.dataset.color!=color) {
							div=undefined;
						}	
					}
					divs[i]=div;
					x=mindex[0];
					y=mindex[1];
				}
				return divs;//数组中的位置代表方向，undefined的为不符合要求的
			}
			//4个方向为基准返回权重，第一个为单列权重最大值，第二个为所有方向权重总和
			function levelson(target,color){
				var chessDirNum=[];
				var level=[0,0];//第一位放权重最大值，第二位放权重总和
				chessDirNum=dirsDivnumson(target,color);
//				console.log(chessDirNum);
				for (var i=0;i<4;i++) {
					if (level[0]<chessDirNum[i]) {
						level[0]=chessDirNum[i];
					}
					level[1]+=chessDirNum[i];
				}
				return level;
				//下面为内部函数
				
				//改进的查找所有方向相同颜色连续div数目，返回一个装有所有方向有效连续div数目的矩阵
					function dirsDivnumson (target,color) {
						var dirnum=[];
						var numx=0;
						var numy=0;
						var huosan=0;
						for (var i=0;i<4;i++) {
							numx=checkDirson(target,i,color,1);
							numy=checkDirson(target,7-i,color,1);
							if ((numx%100===0)&&(numy%100===0)) {
								if (numx+numy>300) {
								dirnum[i]=numx+numy;
								}else{
								dirnum[i]=0;	
								}
							}else if((numx%100!==0)&&(numy%100!==0)){
								if (numx+numy>200) {
									huosan++;
									if (huosan>1) {
										dirnum[i]=360+huosan;
										huosan=0;
										continue;
									}
								}
								dirnum[i]=numx+numy;
								
							}else{
								dirnum[i]=numx-numx%100+numy-numy%100;
							}
						}	
//						console.log(dirnum,target);
						return dirnum;
					}
					//查找制定方向、颜色的连续div数目，根据数目返回权重
					function checkDirson (target,dir,color,status) {
						var div=dirTarget(target,dir);
						var num=0;
						if (status==1) {
							if (div!=undefined&&checkColor(div,color)) {
								num=num+100;//一个方向有一个相同子权重+100，继续检查这个方向上的下一个
								num+=checkDirson(div,dir,color,1);	
							}
						} 
						//下面这一段是排除第一圈周围的情况，暂时用不到了
//						else if(status==2){
//							if (div!=undefined&&checkColor(div,color)) {
//								num=num+100;
//								num+=checkDir(div,dir,color,2);
//							}
//							if(div!=undefined&&div.dataset.color==""){
//								num=1;	
//							}
//						}
						//一个方向上终点为空则权重+1，为空且下一个为同色则+2
						if(div!=undefined&&div.dataset.color==""){
								num=1;
								div=dirTarget(div,dir);
								if (div!=undefined&&checkColor(div,color)) {
									num=2;
								}
							}
						return num;
					}	
			}
			//对对象数组的每个成员计算权重得出最高的一个，返回一个数组，0位是对象，1位是单列最大权重，2位是总权重
			function levelmax(targets,color) {
				var level=[0,0];
				var divdata=[undefined,0,0];
					for(var i=0;i<targets.length;i++){
						if (targets[i]!=undefined) {
							level=levelson(targets[i],uncolor);//周围空位点对应的权重
							console.log(targets[i],level);
							if (level[0]>350) {
								divdata[1]=level[0];
								divdata[2]=level[1];
								divdata[0]=targets[i];
								return divdata;
							}
							if (divdata[1]<level[0]) {
								divdata[1]=level[0];//得出单列权重最大的点位
								divdata[2]=level[1];
								divdata[0]=targets[i];
							}else if(divdata[1]==level[0]){//	如果单列权重相等
								if (divdata[2]<level[1]) {
									divdata[2]=level[1];//得出周围整体权重最大的点位
									divdata[0]=targets[i];
								}
							}
						}
					}
				return divdata;
			}
			//AI防守，列举可下点->计算每点权重->得出选择点
			function protectPson (target,uncolor) {
				var divs=[];//存放所有备选目标点对象
				var levels=[];
				var div;
				var counts=-1;
				var count=-1;
				divs=canAroundChess(target,"");//周围域选点函数
				for(var i=0;i<divs.length;i++){
					if (divs[i]!=undefined) {
						levels[i]=levelson(divs[i],uncolor);//周围空位点对应的权重
						console.log(divs[i],levels[i]);
						if (levels[i][0]>350) {
							div=divs[i];
							return div;
						}
						if (counts<levels[i][0]) {
							counts=levels[i][0];//得出单列权重最大的点位
							count=levels[i][1];
							div=divs[i];
						}else if(counts==levels[i][0]){//	如果单列权重相等
							if (count<levels[i][1]) {
								count=levels[i][1];//得出周围整体权重最大的点位
								
								div=divs[i];
							}
						}
					}
				}
//				console.log(div);
				divs=[];
				levels=[];
				divs=linesDirTarget(target,uncolor);//支线选点函数
				if (divs.length>0) {
					for (var i=0;i<divs.length;i++) {
						levels[i]=levelson(divs[i],uncolor);//支线点位对应的权重
						console.log(divs[i],levels[i]);
						if (levels[i][0]>350) {
							div=divs[i];
							return div;
						}
						if (counts<levels[i][0]) {
							counts=levels[i][0];//得出单列权重最大的点位
							count=levels[i][1];
							div=divs[i];
						}else if(counts==levels[i][0]){//	如果单列权重相等
							if (count<levels[i][1]) {
								count=levels[i][1];//得出周围整体权重最大的点位
								div=divs[i];
							}
						}
					}
				} 
				return div;
			}
			//AI防守，列举可下点->计算每点权重->得出选择点
			function protectPi (target,uncolor) {
				var divs=[];//存放所有备选目标点对象
				var level=[0,0];//存放当前对象权重
				var divdata=[undefined,0,0];//存放最大权重对象数据
				divs=canAroundChess(target,"");//周围域选点函数
					for(var i=0;i<divs.length;i++){
//					console.log(div,counts,count);
						if (divs[i]!=undefined) {
							level=levelson(divs[i],uncolor);//周围空位点对应的权重
//							console.log(divs[i],level);
							if (level[0]>350) {
								divdata[1]=level[0];
								divdata[2]=level[1];
								divdata[0]=divs[i];
								return divdata;
							}
							if (divdata[1]<level[0]) {
								divdata[1]=level[0];//得出单列权重最大的点位
								divdata[2]=level[1];
								divdata[0]=divs[i];
							}else if(divdata[1]==level[0]){//	如果单列权重相等
								if (divdata[2]<level[1]) {
									divdata[2]=level[1];//得出周围整体权重最大的点位
									divdata[0]=divs[i];
								}
							}
						}
					}
				divs=[];
				divs=linesDirTarget(target,uncolor);//支线选点函数
				 for(var i=0;i<divs.length;i++){
						if (divs[i]!=undefined) {
							level=levelson(divs[i],uncolor);//周围空位点对应的权重
//							console.log(divs[i],level);
							if (level[0]>350) {
								divdata[1]=level[0];
								divdata[2]=level[1];
								divdata[0]=divs[i];
								return divdata;
							}
							if (divdata[1]<level[0]) {
								divdata[1]=level[0];//得出单列权重最大的点位
								divdata[2]=level[1];
								divdata[0]=divs[i];
							}else if(divdata[1]==level[0]){//	如果单列权重相等
								if (divdata[2]<level[1]) {
									divdata[2]=level[1];//得出周围整体权重最大的点位
									divdata[0]=divs[i];
								}
							}
						}
					}
//				 console.log(divdata);
				return divdata;
			}
			
			//AI进攻，列举可下点->计算每点权重->得出选择点
			function attack(targets,color) {
			var divdata=[undefined,0,0];	
			var 	divs=[];//周围域选点函数
				for (var i=0;i<targets.length;i++) {
					divs[i]=protectPi(targets[i],color);
//					console.log(divs[i]);
				}
				 for(var i=0;i<divs.length;i++){
						if (divs[i][0]!=undefined) {
							if (divdata[1]<divs[i][1]) {
								divdata[1]=divs[i][1]
								divdata[0]=divs[i][0];
								divdata[2]=divs[i][2];
							}else if (divdata[1]==divs[i][1]) {
								if (divdata[2]<divs[i][2]) {
									divdata[2]=divs[i][2];//得出周围整体权重最大的点位
									divdata[0]=divs[i][0];
								}
							}
						}
					}
//				console.log(divdata);
				return divdata;
			}
			//AI进行落子步骤
			function aiDochess(ptarget,color){
				var p_data;
				var a_data;
				var div;
				var uncolor=(color=="white")?"black":"white";
				p_data=protectPi(ptarget,uncolor);
				a_data=attack(AImatix,color);
				console.log("这是防守点");
				console.log(p_data);
				console.log("这是进攻点");
				console.log(a_data);
				if (p_data[1]>400) {
					div=p_data[0];
				}else if(p_data[1]<=a_data[1]||a_data[1]>300){
					div=a_data[0];
				}else{div=p_data[0];}
				
				
				
				
				
				
				
//				if (a_data[1]>400) {
//					div=a_data[0];
//					return div;
//				}
//				if (p_data[1]>350) {
//					div=p_data[0];
//				}else if(p_data[1]>a_data[1]){
//					div=p_data[0];
//				}else if(p_data[1]=a_data[1]){
//					if(p_data[2]>a_data[2]){
//					div=p_data[0];
//					}else{
//					div=a_data[0];	
//					}
//				}else{div=a_data[0];}
				
				AImatix[AImatix.length]=div;
//				downChess(div,color);
				return div;
//				rule(div,color);
			}
			
			
		}
	</script>
</html>
